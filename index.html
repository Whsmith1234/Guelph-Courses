<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.19.1/cytoscape.min.js"></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Guelph Courses</title>
	<link rel="stylesheet" href ="boot/css/bootstrap.min.css"></link>
	<script type="text/javascript" src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
	<style>
		#search{
			width: 100%;
			height: 5rem;
			border: none;
			background-color: rgb(0,0,0,0.02); 
			font-size:16px;
		}
		.search{
			width:100%;
			height: 5rem;
			border: none;
			background-color: rgb(0,0,0,0.05); 
		}
		.fixed{
			background-color: white;

		}
		.graph{
			width:100%;
			height: 5rem;
			border: none;
			background-color: rgb(0,0,0,0.05); 
		}
	</style>
</head>
<body>
	

	<br>
	<div class="container">
		<span class="fixed navbar-fixed-top">
			<div class="container"><center><h1>Guelph Courses</h1></center><input type="text" placeholder ="Search Ex: MATH*1210 or MATH "id="search" class=""><button class ="search" onclick="findCourse(Courses, Data,document.getElementById('search').value.toUpperCase())">Search</button></div></span>
			<br>
			<br>
			<br>
			<br>
			<br>
			
			<div id="mynetwork"></div>
		<div id="results"></div>
		
	</div>
	
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.js"></script>
	
	<script type="text/javascript">
	var Data = [];
var Names = [];
var Courses = [];
var Highlighted = [];

fetch("/new.json")
  .then((response) => response.text())
  .then((data) => MAIN(data));

function MAIN(data) {
  data = data.split("\n");
  for (var i = 0; i < data.length; i++) {
    data[i] = data[i].split(",");
    data[i].length = data[i].length - 1;
  }
  Data = data;
  fetch("/newNames.json")
    .then((response) => response.text())
    .then((data) => START(data));
}
function START(names) {
  names = names.split("\n");
  for (var i = 0; i < names.length; i++) {
    names[i] = names[i].split("|,");
  }
  var courses = [];
  for (var i = 0; i < names.length; i++) {
    courses[i] = names[i][0];
    //console.log(courses[i]);
  }
  courses.length = courses.length - 1;
  Names = names;
  Courses = courses;

  findCourse(Courses, Data, "ECON*4800");
}
function findCourse(Courses, CourseArray, searchTerm) {
  for (var i = 0; i < Courses.length; i++) {
    Highlighted[i] = 0;
  }
  var HTML = "";
  var f = search(Courses, searchTerm, 0);
	if (f == -1){ filterGraph(searchTerm)}else{
	
  HTML += "<h2>Course: " + searchTerm + "</h2><br>";
  if (Names[f][1]) {
    HTML += Names[f][1] + "<br>";
  }
  HTML += "<h3>Pre Requisities</h3>" + "<br>";
  console.log(f);
  Highlighted[f]=1;
  console.log("hey "+Highlighted[f]);
  for (var i = 0; i < Courses.length; i++) {
    //console.log(CourseArray[i][f]);
    if (CourseArray[i][f] == 1) {
      recursiveAdding(i, 0, -1);
      HTML += "<h5>" + Courses[i] + "</h5><br>";
      if (Names[i][1]) {
        HTML += Names[i][1] + "<br>";
      }
    }
  }
  HTML += "<h3>Leads to</h3>" + "<br>";
  for (var i = 0; i < Courses.length; i++) {
    if (CourseArray[f][i] == 1) {
      recursiveAdding(i, 0, 1);
      HTML += Courses[i] + "<br>";
      if (Names[i][1]) {
        HTML += Names[i][1] + "<br>";
      }
    }
  }
  document.getElementById("results").innerHTML = HTML;
	printGraph();
}
}
function recursiveAdding(searchTerm, jumps, direction) {
  if (direction == 1) {
    jumps++;
    if (jumps < 4) {
      if (Highlighted[searchTerm] != 1) {
        Highlighted[searchTerm] = 1;
        for (var i = 0; i < Courses.length; i++) {
          if (Data[i][searchTerm] == 1) Highlighted[i] == 1;
          if (Data[searchTerm][i] == 1) {
            recursiveAdding(i, jumps);
          }
        }
      }
    }
  } else {
    jumps++;
    if (jumps < 4) {
      if (Highlighted[searchTerm] != 1) {
        Highlighted[searchTerm] = 1;
        for (var i = 0; i < Courses.length; i++) {
          if (Data[i][searchTerm] == 1) {
            recursiveAdding(i, jumps);
          }
        }
      }
    }
  }
}

function search(data, course, index) {
  if (data.length > 1 && data[0] != course) {
    var midPoint = Math.floor(data.length / 2);
    if (data[midPoint] < course) {
      var d = midPoint + index;
      var newData = [];
      for (var i = midPoint; i < data.length; i++) {
        newData[i - midPoint] = data[i];
      }
      //console.log(newData);
      return search(newData, course, d);
    } else if (data[midPoint] > course) {
      var newData = [];
      for (var i = 0; i < midPoint; i++) {
        newData[i] = data[i];
      }
      //console.log(newData);
      return search(newData, course, index);
    } else {
      return index + midPoint;
    }
  } else if (data[0] == course) {
    return 0;
  } else {
    return -1;
  }
}

function filterGraph(searchTerm) {
  if (searchTerm) {
    var nodes = new vis.DataSet([]);
    var edges = new vis.DataSet([]);
    var l = Courses.length;
    for (var i = 0; i < l; i++) {
      if (Courses[i].includes(searchTerm)) {
        nodes.add({ id: i, label: Courses[i] });
        for (var j = 0; j < l; j++) {
          if (Data[i][j] == 1) {
            edges.add({ from: i, to: j, arrows: "to" });
          }
        }
      }
    }
    ///console.log(nodes);
    // create an array with edges

    // create a network
    var container = document.getElementById("mynetwork");
    container.style = `
  width: 100%;
  height:  80rem;
  border: 1px solid lightgray;
`;
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {
      layout: {
        hierarchical: {
          direction: "UD"
        }
      }
    };
    var network = new vis.Network(container, data, options);
  }
}

function printGraph() {
  var nodes = new vis.DataSet([]);
  var edges = new vis.DataSet([]);
  console.log(Courses);
  var l = Courses.length;
  for (var i = 0; i < l; i++) {
    if (Highlighted[i] == 1) {
      nodes.add({ id: i, label: Courses[i] });
      for (var j = 0; j < l; j++) {
        if (Data[i][j] == 1) {
          edges.add({ from: i, to: j, arrows: "to" });
        }
      }
    }
  }
  ///console.log(nodes);
  // create an array with edges

  // create a network
  var container = document.getElementById("mynetwork");
  container.style = `
  width: 100%;
  height:  80rem;
  border: 1px solid lightgray;
`;
  var data = {
    nodes: nodes,
    edges: edges
  };
  var options = {
    layout: {
      hierarchical: {
        direction: "UD"
      }
    }
  };
  var network = new vis.Network(container, data, options);
}

	</script>
	<script>


	</script>
</body>
</html>